%% test cvx basic solution of the PGO 

d=2;     % dimension of the Orthogonal and Special Orthogonal group   
n=6;   % number of poses 
w_r=0.01;   % covariance of the noise  

% data creation for synthetic dataset 


%Ground truth

X_gt = [0,5,7,6,3,0.5];
Y_gt = [0,2,4,7,5,1]; 
R_gt = [0,30,90, 120, 190,260];    %degree angle 
U_gt = zeros(0,6);
V_gt = zeros (0,6);

for i=1:6
    U_gt(i) = cos(R_gt(i)*pi/180); 
    V_gt(i) = sin(R_gt(i)*pi/180); 
end

%plot(X_gt,Y_gt)
quiver(X_gt,Y_gt,U_gt,V_gt)

% Ground truth measurement edges: 

tx_m_gt=[5,2,-1,-3,-2.5,-0.5];
ty_m_gt=[2,2,3,-2,-4,-1]; 
R_m_gt=[30,60,30,70,80,-270];


% Noisy measurement edges:
tx_m=tx_m_gt+0.1*randn() ;
ty_m=ty_m_gt+0.1*randn();
R_m= R_m_gt*pi/180+ 0.01*randn();


%Initial guess (just add some error to the initial ground truth)

X_ini = [0.1, 4, 6, 5, 2, 0.3];
Y_ini = [0.2, 1, 3, 6, 4, 0.8];
R_ini = [10, 40, 80, 110, 180, 250];

%PGO formulation in cvx 
d=2;     % dimension of the Orthogonal and Special Orthogonal group   
n=6;   % number of poses 


cvx_begin sdp

    variable X(2*n,2*n);
    
    minimize ((w_r/2)*norm(X(i,j)-R_m(i)));
    
    subject to 
        X >= 0;
        for k=1:n 
           X(2*k,2*k,2,2)=eyes(2); 
        end
    % r(n-1:-1:1) == conj(r(n+1:end));
    %for k = 1 : n,
        
    %end
    
        
cvx_end

%plot results 